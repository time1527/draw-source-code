<mxfile host="Electron" modified="2024-05-16T09:51:34.268Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.2.5 Chrome/120.0.6099.109 Electron/28.1.0 Safari/537.36" etag="jwWrt_aP0-Anoc3Uh0_4" version="24.2.5" type="device">
  <diagram name="第 1 页" id="9Vd3KVHq0Vw0dPwcsbAY">
    <mxGraphModel dx="1903" dy="1154" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1700" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="zUwRd-FuLXhXHju-uJP1-22" value="&lt;div style=&quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.scaling_factor = scaling_factor&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.dim = dim&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.max_position_embeddings = max_position_embeddings&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.base = base&lt;/div&gt;&lt;div&gt;inv_freq = &lt;span style=&quot;color: #b5cea8;&quot;&gt;1.0&lt;/span&gt; / (&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.base ** (torch.arange(&lt;span style=&quot;color: rgb(181, 206, 168);&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;self&lt;/span&gt;.dim, &lt;span style=&quot;color: rgb(181, 206, 168);&quot;&gt;2&lt;/span&gt;, dtype=torch.int64).float().to(device) / &lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;self&lt;/span&gt;.dim)) &lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;# inv_freq = 1/theta: torch.Size([dim/2])&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.register_buffer(&lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;inv_freq&quot;&lt;/span&gt;, inv_freq, persistent=&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.max_seq_len_cached = max_position_embeddings&lt;/div&gt;&lt;div&gt;t = torch.arange(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.max_seq_len_cached, device=device, dtype=torch.int64).type_as(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.inv_freq) &lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6a9955;&quot;&gt;# t: torch.Size([max_position_embeddings])&lt;/span&gt;&lt;/div&gt;&lt;div&gt;t = t / &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.scaling_factor&lt;/div&gt;&lt;div&gt;freqs = torch.outer(t, &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.inv_freq) &amp;nbsp;&lt;span style=&quot;color: #6a9955;&quot;&gt;# torch.Size([max_position_embeddings, dim/2])&lt;/span&gt;&lt;/div&gt;&lt;div&gt;emb = torch.cat((freqs, freqs), dim=-&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;) &lt;span style=&quot;color: #6a9955;&quot;&gt;# torch.Size([max_position_embeddings, dim])&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.register_buffer(&lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;_cos_cached&quot;&lt;/span&gt;, emb.cos().to(torch.get_default_dtype()), persistent=&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.register_buffer(&lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;_sin_cached&quot;&lt;/span&gt;, emb.sin().to(torch.get_default_dtype()), persistent=&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="180" y="30" width="910" height="320" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;" parent="1" source="zUwRd-FuLXhXHju-uJP1-2" target="zUwRd-FuLXhXHju-uJP1-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="zUwRd-FuLXhXHju-uJP1-2" target="zUwRd-FuLXhXHju-uJP1-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-2" value="&lt;div style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;LlamaRotaryEmbedding&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#cce5ff;strokeColor=#36393d;" parent="1" vertex="1">
          <mxGeometry x="38" y="390" width="165" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-3" value="&lt;div style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;__init__&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#cdeb8b;strokeColor=#36393d;" parent="1" vertex="1">
          <mxGeometry x="85" y="175" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-4" value="&lt;div style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;forward&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#cdeb8b;strokeColor=#36393d;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="90" y="520" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-11" value="" style="shape=image;verticalLabelPosition=bottom;labelBackgroundColor=default;verticalAlign=top;aspect=fixed;imageAspect=0;image=data:image/png,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;" parent="1" vertex="1">
          <mxGeometry x="677.96" y="80" width="412.04" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-21" value="&lt;div style=&quot;background-color: rgb(30, 30, 30); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;div style=&quot;color: rgb(212, 212, 212);&quot;&gt;&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; line-height: 19px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;@&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;torch&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;no_grad&lt;/span&gt;()&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;forward&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;position_ids&lt;/span&gt;):&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #6a9955;&quot;&gt;# x: [bs, num_attention_heads, seq_len, head_size]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #6a9955;&quot;&gt;# position_ids:[1,seq_len]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #9cdcfe;&quot;&gt;inv_freq_expanded&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.inv_freq[&lt;span style=&quot;color: #4fc1ff;&quot;&gt;None&lt;/span&gt;, :, &lt;span style=&quot;color: #4fc1ff;&quot;&gt;None&lt;/span&gt;].float().expand(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;position_ids&lt;/span&gt;.shape[&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;], &lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;) &lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;# inv_freq_expanded: [1, dim/2, 1]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #9cdcfe;&quot;&gt;position_ids_expanded&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;position_ids&lt;/span&gt;[:, &lt;span style=&quot;color: #4fc1ff;&quot;&gt;None&lt;/span&gt;, :].float() &lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;# position_ids_expanded: [1,1,&lt;/span&gt;&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;seq_len&lt;/span&gt;&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;.device.type&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt; &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;isinstance&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt;, &lt;span style=&quot;color: #4ec9b0;&quot;&gt;str&lt;/span&gt;) &lt;span style=&quot;color: #569cd6;&quot;&gt;and&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;mps&quot;&lt;/span&gt; &lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt; &lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;cpu&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #c586c0;&quot;&gt;with&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;torch&lt;/span&gt;.&lt;span style=&quot;color: #4ec9b0;&quot;&gt;autocast&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;device_type&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;enabled&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #4fc1ff;&quot;&gt;False&lt;/span&gt;):&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #6a9955;&quot;&gt;# get m theta&lt;/span&gt;&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #9cdcfe;&quot;&gt;freqs&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;inv_freq_expanded&lt;/span&gt;.float() &lt;span style=&quot;color: #d4d4d4;&quot;&gt;@&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;position_ids_expanded&lt;/span&gt;.float()).transpose(&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #9cdcfe;&quot;&gt;emb&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;torch&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;cat&lt;/span&gt;((&lt;span style=&quot;color: #9cdcfe;&quot;&gt;freqs&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;freqs&lt;/span&gt;), &lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;) &lt;span style=&quot;color: #6a9955;&quot;&gt;# torch.Size([1, seq_len, dim])&lt;/span&gt;&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;emb&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;cos&lt;/span&gt;()&lt;/div&gt;&lt;div&gt;        &lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;emb&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;sin&lt;/span&gt;()&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;to&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dtype&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;.dtype), &lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;to&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dtype&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;.dtype)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="340" width="1120" height="330" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-23" value="&lt;div style=&quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt; rotate_half(x):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;&quot;&quot;Rotates half the hidden dims of the input.&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; x1 = x[..., : x.shape[-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;] // &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; x2 = x[..., x.shape[-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;] // &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt; :]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt; torch.cat((-x2, x1), dim=-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="650" width="400" height="100" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-24" value="&lt;div style=&quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt; apply_rotary_pos_emb(q, k, cos, sin, position_ids=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;None&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;, unsqueeze_dim=&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #ce9178;&quot;&gt;&quot;&quot;&quot;Applies Rotary Position Embedding to the query and key tensors.&quot;&quot;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; cos = cos.unsqueeze(unsqueeze_dim)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; sin = sin.unsqueeze(unsqueeze_dim)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; q_embed = (q * cos) + (rotate_half(q) * sin)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; k_embed = (k * cos) + (rotate_half(k) * sin)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt; q_embed, k_embed&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="60" y="780" width="560" height="160" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-29" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;strokeColor=#36393d;strokeWidth=2;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;fillColor=#cdeb8b;" parent="1" vertex="1">
          <mxGeometry x="155" y="40" width="25" height="300" as="geometry" />
        </mxCell>
        <mxCell id="zUwRd-FuLXhXHju-uJP1-30" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;strokeColor=#36393d;strokeWidth=2;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;fillColor=#cdeb8b;" parent="1" vertex="1">
          <mxGeometry x="155" y="457.5" width="25" height="155" as="geometry" />
        </mxCell>
        <UserObject label="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: &#39;Droid Sans Mono&#39;, &#39;monospace&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(q_embed.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(q_embed.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; q[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; cos[&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; sin[&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;len&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;torch&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;zeros&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;len&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;len&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;print&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; q_embed[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;])&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" link="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: &#39;Droid Sans Mono&#39;, &#39;monospace&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(q_embed.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(q_embed.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; q[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; cos[&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; sin[&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;len&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;.shape[&lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;torch&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;zeros&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;len&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;))&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;len&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;for&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;range&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;cos_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;] &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;sin_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;q_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;i&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;j&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;dim&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;)]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;print&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;res_slice&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;==&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt; q_embed[&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;][&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;])&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" id="qMjrYYB6KkKD8-KnIWCA-2">
          <mxCell style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
            <mxGeometry x="760" y="680" width="560" height="380" as="geometry" />
          </mxCell>
        </UserObject>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
